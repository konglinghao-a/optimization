## 代码优化

## 3-1 javascript  的开销和如何缩短解析时间

我们加载的资源包括 css，js，图片，字体... 这些资源的大小本身可能都非常大，但是 js 在这里面还是开销最重的。因为 js 除了加载以外，它还要进行解析和编译，然后才是执行，这两步也是非常耗时的。下面可以来看看资源大小差不多的情况下，js 和 图片的时间开销：

![](./media/1.jpg)

由上面的图可以发现，他们在网络传输的过程中所消耗的时间是一样的，但是在资源加载的过程中，js 需要解析编译，然后执行；而图片只需要解码和绘制即可。

通过上面的分析，就可以知道优化的方向就是减少 js 编译和运行的时间。

### 优化方案

- code splitting 代码拆分，按需加载
- tree shaking 代码减重

减少主线程的工作量：

- 避免长任务
- 避免超过 1kB 的行间脚本
- 使用 rAF 和 rIC 进行时间调度

### 渐进式启动（progressive bootstrapping）

- 可见不可交互 vs 最小可交互资源集

![](./media/2.jpg)

## 3-2 配合 v8 优化代码

我们需要配合 v8 去做一些优化，要避免让 v8 产生反优化的代码。[可以看看这篇](https://juejin.im/post/6844903989939535885)。

### 抽象语法树

- 源码 => 抽象语法树 => 字节码 Bytecode => 机器码
- 编译过程会进行优化
- 运行时可能发生反优化

### v8 有代表性的优化机制

- 脚本流
- 字节码缓存
- 懒解析

## 3-3 函数优化

像 v8 这样的引擎会对函数进行懒解析